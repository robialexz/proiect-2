<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reparare Autentificare</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
            color: #333;
        }
        h1 {
            color: #4338ca;
            border-bottom: 2px solid #e5e7eb;
            padding-bottom: 10px;
        }
        .card {
            background-color: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        button {
            background-color: #4f46e5;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin-top: 10px;
        }
        button:hover {
            background-color: #4338ca;
        }
        .success {
            color: #047857;
            font-weight: bold;
        }
        .steps {
            margin-top: 20px;
        }
        .steps ol {
            padding-left: 20px;
        }
        .steps li {
            margin-bottom: 10px;
        }
        code {
            background-color: #f1f5f9;
            padding: 2px 4px;
            border-radius: 4px;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <h1>Reparare Autentificare pentru Dezvoltare</h1>
    
    <div class="card">
        <h2>Pasul 1: Curăță datele de sesiune existente</h2>
        <p>Mai întâi, trebuie să ștergi datele de sesiune existente:</p>
        <ol>
            <li>Deschide DevTools în browser (F12 sau click dreapta -> Inspect)</li>
            <li>Mergi la tab-ul "Application" sau "Aplicație"</li>
            <li>În secțiunea "Storage" din stânga, selectează "Local Storage" și apoi domeniul localhost</li>
            <li>Șterge toate cheile care încep cu "supabase" sau conțin "session"</li>
            <li>Fă același lucru pentru "Session Storage"</li>
        </ol>
    </div>

    <div class="card">
        <h2>Pasul 2: Creează o sesiune de test</h2>
        <p>Apasă butonul de mai jos pentru a crea o sesiune de test validă:</p>
        <button id="createSession">Creează Sesiune de Test</button>
        <p id="result"></p>
    </div>

    <div class="card steps">
        <h2>Pasul 3: Reîncarcă aplicația</h2>
        <p>După ce ai creat sesiunea de test:</p>
        <ol>
            <li>Deschide aplicația la adresa <a href="http://localhost:5174" target="_blank">http://localhost:5174</a></li>
            <li>Ar trebui să fii autentificat automat ca utilizator de test</li>
            <li>Dacă tot primești eroarea "sesiunea a expirat", încearcă să te autentifici manual cu:</li>
            <ul>
                <li>Email: <code>test@example.com</code></li>
                <li>Parolă: <code>password123</code> (sau orice parolă)</li>
            </ul>
        </ol>
    </div>

    <script>
        document.getElementById('createSession').addEventListener('click', function() {
            // Creăm un utilizator de test
            const testUser = {
                id: 'test-user-id-' + Date.now().toString(36),
                email: 'test@example.com',
                user_metadata: {
                    name: 'Test User',
                    role: 'utilizator'
                },
                app_metadata: {
                    provider: 'email'
                },
                aud: 'authenticated',
                role: 'authenticated'
            };

            // Creăm o sesiune de test
            const testSession = {
                access_token: 'test-token-' + Date.now().toString(36),
                refresh_token: 'test-refresh-' + Date.now().toString(36),
                expires_at: Date.now() + 30 * 24 * 3600 * 1000, // 30 zile
                user: testUser
            };

            // Creăm obiectul de sesiune pentru Supabase
            const sessionData = {
                currentSession: testSession,
                expiresAt: Date.now() + 30 * 24 * 3600 * 1000 // 30 zile
            };

            // Salvăm sesiunea în localStorage și sessionStorage
            localStorage.setItem('supabase.auth.token', JSON.stringify(sessionData));
            sessionStorage.setItem('supabase.auth.token', JSON.stringify(sessionData));

            // Creăm și o sesiune de rezervă
            const fallbackSession = {
                access_token: 'test-token-' + Date.now().toString(36),
                refresh_token: 'test-refresh-' + Date.now().toString(36),
                expires_at: Date.now() + 30 * 24 * 3600 * 1000, // 30 zile
                user: testUser
            };
            localStorage.setItem('fallback_session', JSON.stringify(fallbackSession));

            document.getElementById('result').innerHTML = '<span class="success">✓ Sesiune de test creată cu succes!</span><br>Acum poți deschide aplicația la <a href="http://localhost:5174" target="_blank">http://localhost:5174</a>';
        });
    </script>
</body>
</html>
